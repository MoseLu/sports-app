import{d as S,c as q,aG as C,r as f,ag as R,ah as E,ai as n,f as l,aH as _,aR as U,aS as W,aj as i,Q as v,aw as g,aU as r,aM as h,ae as y,aT as j,al as B}from"./index-DeRF4HPo.js";import{Q as L,l as w}from"./QForm-CxZGyJKj.js";import{Q as A,b as M}from"./QCard-CJ7eyBD_.js";const N={class:"reset-page"},O={class:"reset-container"},T={class:"reset-content"},$={class:"reset-header"},D=["src"],F={class:"row justify-center"},G={class:"text-center q-mt-md"},H=S({__name:"ResetPasswordPage",setup(z){const b=j(),x=C(),P=q(()=>x.dark.isActive),c=f(!1),u=f(0),a=f({email:"",code:"",newPassword:"",confirmPassword:""}),p=f(!1),V=t=>{if(typeof t=="string"){const e=t.toLowerCase();if(!/.+@.+\..+/.test(e)){p.value=!1;return}const s=e.endsWith("@outlook.com")||e.endsWith("@hotmail.com")||e.endsWith("@msn.com")||e.endsWith("@bellis-technology.cn")||e.includes("@microsoft")||e.includes("@office365"),m=e.endsWith("@qq.com");p.value=s||m}else p.value=!1},Q=()=>{u.value=30;const t=setInterval(()=>{u.value--,u.value<=0&&clearInterval(t)},1e3)},k=()=>{if(!a.value.email){r("请输入邮箱地址");return}if(!p.value){r("请输入有效的邮箱地址（支持 QQ 邮箱、Outlook 邮箱和 Microsoft 365 邮箱）");return}try{c.value=!0,h("验证码已发送到您的邮箱"),Q(),y.post("/api/auth/send-reset-code",{email:a.value.email}).catch(t=>{var e,s;console.error("发送验证码失败:",t),t&&typeof t=="object"&&"response"in t&&((s=(e=t.response)==null?void 0:e.data)==null?void 0:s.error)==="该邮箱未注册"&&(r("该邮箱尚未注册，请先注册"),localStorage.setItem("register_email",a.value.email),setTimeout(()=>{b.push("/register")},2e3))})}finally{c.value=!1}},I=async()=>{var t,e,s,m;if(!a.value.code){r("请输入验证码");return}if(!a.value.newPassword){r("请输入新密码");return}if(a.value.newPassword!==a.value.confirmPassword){r("两次输入的密码不一致");return}c.value=!0;try{const o=await y.post("/api/auth/reset-password",{email:a.value.email,code:a.value.code,newPassword:a.value.newPassword});if(console.log("Reset password response:",o.data),o.status===200&&o.data){const d=((t=o.data.data)==null?void 0:t.username)||o.data.username;d&&(console.log("Saving username:",d),localStorage.setItem("rememberedUsername",d)),h("密码重置成功"),await b.push("/login")}else r("重置密码失败，请稍后重试")}catch(o){if(console.error("Reset password error:",o),o&&typeof o=="object"&&"response"in o){const d=o;((e=d.response)==null?void 0:e.status)===400?r(((s=d.response.data)==null?void 0:s.error)||"验证码错误或已过期"):((m=d.response)==null?void 0:m.status)===500?r("服务器错误，请稍后重试"):r("重置密码失败，请稍后重试")}else r("重置密码失败，请稍后重试")}finally{c.value=!1}};return(t,e)=>(E(),R("div",N,[n("div",O,[n("div",T,[n("div",$,[n("img",{src:P.value?_(U):_(W),alt:"Re Sports",class:"logo"},null,8,D),e[4]||(e[4]=n("h1",{class:"reset-title"},"重置密码",-1)),e[5]||(e[5]=n("p",{class:"text-subtitle1 q-mt-sm text-weight-medium text-center"}," 请输入您的邮箱地址，我们将向您发送重置密码的链接 ",-1))]),l(A,{class:"reset-card q-mt-lg"},{default:i(()=>[l(M,null,{default:i(()=>[l(L,{onSubmit:I,class:"q-gutter-md"},{default:i(()=>[l(w,{modelValue:a.value.email,"onUpdate:modelValue":[e[0]||(e[0]=s=>a.value.email=s),V],type:"email",label:"邮箱",rules:[s=>!!s||"请输入邮箱",s=>/.+@.+\..+/.test(s)||"请输入有效的邮箱"],outlined:"",class:"input-field",clearable:""},{prepend:i(()=>[l(v,{name:"email"})]),_:1},8,["modelValue","rules"]),l(w,{modelValue:a.value.code,"onUpdate:modelValue":e[1]||(e[1]=s=>a.value.code=s),label:"验证码",rules:[s=>!!s||"请输入验证码"],outlined:"",class:"input-field",clearable:""},{prepend:i(()=>[l(v,{name:"key"})]),append:i(()=>[l(g,{flat:"",dense:"",label:u.value>0?`${u.value}秒后重试`:"获取验证码",disable:u.value>0,onClick:k,class:"text-primary"},null,8,["label","disable"])]),_:1},8,["modelValue","rules"]),l(w,{modelValue:a.value.newPassword,"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.newPassword=s),type:"password",label:"新密码",rules:[s=>!!s||"请输入新密码",s=>s.length>=6||"密码长度不能少于6位"],outlined:"",class:"input-field",clearable:""},{prepend:i(()=>[l(v,{name:"lock"})]),_:1},8,["modelValue","rules"]),l(w,{modelValue:a.value.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.confirmPassword=s),type:"password",label:"确认密码",rules:[s=>!!s||"请确认密码",s=>s===a.value.newPassword||"两次输入的密码不一致"],outlined:"",class:"input-field",clearable:""},{prepend:i(()=>[l(v,{name:"lock"})]),_:1},8,["modelValue","rules"]),n("div",F,[l(g,{label:"重置密码",type:"submit",color:"primary",class:"reset-btn",loading:c.value,unelevated:"",rounded:""},null,8,["loading"])]),n("div",G,[l(g,{flat:"",dense:"",label:"返回登录",to:"/login",class:"text-primary"})])]),_:1})]),_:1})]),_:1}),e[6]||(e[6]=n("div",{class:"reset-footer q-mt-xl"},[n("p",{class:"text-caption text-weight-medium text-center"}," © 2025 Re Sports. All rights reserved. ")],-1))])])]))}}),Y=B(H,[["__scopeId","data-v-51015d6f"]]);export{Y as default};
