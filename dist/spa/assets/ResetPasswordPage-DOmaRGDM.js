import{d as S,c as q,aF as C,r as f,af as R,ag as E,ah as n,f as l,aG as _,aQ as U,aR as B,ai as i,Q as v,av as g,aT as r,aL as y,ad as x,aS as L,ak as W}from"./index-QLc2gC4p.js";import{Q as j,l as w}from"./QForm-CjASUU2i.js";import{Q as A,b as F}from"./QCard-kJKPxq7A.js";const N={class:"reset-page"},O={class:"reset-container"},T={class:"reset-content"},$={class:"reset-header"},D=["src"],G={class:"row justify-center"},z={class:"text-center q-mt-md"},H=S({__name:"ResetPasswordPage",setup(J){const b=L(),P=C(),h=q(()=>P.dark.isActive),c=f(!1),u=f(0),a=f({email:"",code:"",newPassword:"",confirmPassword:""}),p=f(!1),Q=t=>{if(typeof t=="string"){const s=t.toLowerCase();if(!/.+@.+\..+/.test(s)){p.value=!1;return}const e=s.endsWith("@outlook.com")||s.endsWith("@bellis-technology.cn"),m=s.endsWith("@qq.com");p.value=e||m}else p.value=!1},V=()=>{u.value=30;const t=setInterval(()=>{u.value--,u.value<=0&&clearInterval(t)},1e3)},k=()=>{if(!a.value.email){r("请输入邮箱地址");return}if(!p.value){r("请输入有效的 Outlook 或 QQ 邮箱地址");return}try{c.value=!0,y("验证码已发送到您的邮箱"),V(),x.post("/api/auth/send-reset-code",{email:a.value.email}).catch(t=>{var s,e;console.error("发送验证码失败:",t),t&&typeof t=="object"&&"response"in t&&((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.error)==="该邮箱未注册"&&(r("该邮箱尚未注册，请先注册"),localStorage.setItem("register_email",a.value.email),setTimeout(()=>{b.push("/register")},2e3))})}finally{c.value=!1}},I=async()=>{var t,s,e,m;if(!a.value.code){r("请输入验证码");return}if(!a.value.newPassword){r("请输入新密码");return}if(a.value.newPassword!==a.value.confirmPassword){r("两次输入的密码不一致");return}c.value=!0;try{const o=await x.post("/api/auth/reset-password",{email:a.value.email,code:a.value.code,newPassword:a.value.newPassword});if(console.log("Reset password response:",o.data),o.status===200&&o.data){const d=((t=o.data.data)==null?void 0:t.username)||o.data.username;d&&(console.log("Saving username:",d),localStorage.setItem("rememberedUsername",d)),y("密码重置成功"),await b.push("/login")}else r("重置密码失败，请稍后重试")}catch(o){if(console.error("Reset password error:",o),o&&typeof o=="object"&&"response"in o){const d=o;((s=d.response)==null?void 0:s.status)===400?r(((e=d.response.data)==null?void 0:e.error)||"验证码错误或已过期"):((m=d.response)==null?void 0:m.status)===500?r("服务器错误，请稍后重试"):r("重置密码失败，请稍后重试")}else r("重置密码失败，请稍后重试")}finally{c.value=!1}};return(t,s)=>(E(),R("div",N,[n("div",O,[n("div",T,[n("div",$,[n("img",{src:h.value?_(U):_(B),alt:"Re Sports",class:"logo"},null,8,D),s[4]||(s[4]=n("h1",{class:"reset-title"},"重置密码",-1)),s[5]||(s[5]=n("p",{class:"text-subtitle1 q-mt-sm text-weight-medium text-center"}," 请输入您的邮箱地址，我们将向您发送重置密码的链接 ",-1))]),l(A,{class:"reset-card q-mt-lg"},{default:i(()=>[l(F,null,{default:i(()=>[l(j,{onSubmit:I,class:"q-gutter-md"},{default:i(()=>[l(w,{modelValue:a.value.email,"onUpdate:modelValue":[s[0]||(s[0]=e=>a.value.email=e),Q],type:"email",label:"邮箱",rules:[e=>!!e||"请输入邮箱",e=>/.+@.+\..+/.test(e)||"请输入有效的邮箱"],outlined:"",class:"input-field",clearable:""},{prepend:i(()=>[l(v,{name:"email"})]),_:1},8,["modelValue","rules"]),l(w,{modelValue:a.value.code,"onUpdate:modelValue":s[1]||(s[1]=e=>a.value.code=e),label:"验证码",rules:[e=>!!e||"请输入验证码"],outlined:"",class:"input-field",clearable:""},{prepend:i(()=>[l(v,{name:"key"})]),append:i(()=>[l(g,{flat:"",dense:"",label:u.value>0?`${u.value}秒后重试`:"获取验证码",disable:u.value>0,onClick:k,class:"text-primary"},null,8,["label","disable"])]),_:1},8,["modelValue","rules"]),l(w,{modelValue:a.value.newPassword,"onUpdate:modelValue":s[2]||(s[2]=e=>a.value.newPassword=e),type:"password",label:"新密码",rules:[e=>!!e||"请输入新密码",e=>e.length>=6||"密码长度不能少于6位"],outlined:"",class:"input-field",clearable:""},{prepend:i(()=>[l(v,{name:"lock"})]),_:1},8,["modelValue","rules"]),l(w,{modelValue:a.value.confirmPassword,"onUpdate:modelValue":s[3]||(s[3]=e=>a.value.confirmPassword=e),type:"password",label:"确认密码",rules:[e=>!!e||"请确认密码",e=>e===a.value.newPassword||"两次输入的密码不一致"],outlined:"",class:"input-field",clearable:""},{prepend:i(()=>[l(v,{name:"lock"})]),_:1},8,["modelValue","rules"]),n("div",G,[l(g,{label:"重置密码",type:"submit",color:"primary",class:"reset-btn",loading:c.value,unelevated:"",rounded:""},null,8,["loading"])]),n("div",z,[l(g,{flat:"",dense:"",label:"返回登录",to:"/login",class:"text-primary"})])]),_:1})]),_:1})]),_:1}),s[6]||(s[6]=n("div",{class:"reset-footer q-mt-xl"},[n("p",{class:"text-caption text-weight-medium text-center"}," © 2025 Re Sports. All rights reserved. ")],-1))])])]))}}),Y=W(H,[["__scopeId","data-v-e815470c"]]);export{Y as default};
